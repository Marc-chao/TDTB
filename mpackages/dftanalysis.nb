(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[     89734,       2296]
NotebookOptionsPosition[     87621,       2223]
NotebookOutlinePosition[     88011,       2240]
CellTagsIndexPosition[     87968,       2237]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"BeginPackage", "[", "\"\<dftanalysis`\>\"", "]"}], "\n", 
 RowBox[{
  RowBox[{"Unprotect", "@@", 
   RowBox[{"Names", "[", "\"\<dftanalysis`*\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "@@", 
   RowBox[{"Names", "[", "\"\<dftanalysis`*\>\"", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.547026674311408*^9, 3.54702667431256*^9}, {
  3.54702892147016*^9, 3.5470289272344637`*^9}, {3.547029194953753*^9, 
  3.5470291954850683`*^9}, {3.547030454603084*^9, 3.547030484364112*^9}, {
  3.547034633494515*^9, 3.54703464787747*^9}, {3.5470347198154783`*^9, 
  3.5470347399704514`*^9}, {3.547035924828367*^9, 3.54703592964351*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GetLatticeFromOUTCAR", "::", "usage"}], "=", 
  "\"\<{directlatticevecs,reclatticevecs}=GetLatticeFromOUTCAR[file] reads \
the VASP OUTCAR file and returns the direct lattice vectors and the \
reciprocal lattice vectors.\>\""}], "\n", 
 RowBox[{
  RowBox[{"ShiftPlotData", "::", "usage"}], "=", 
  "\"\<ShiftPlotData[plotdata,shift] shifts the plot data, generated with \
CreateTBPlotData, by a given energy.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateVaspBandstructurePlotData", "::", "usage"}], "=", 
  "\"\<{plotdata,path,puredata}=CreateVaspBandstructurePlotData[file] reads a \
VASP EIGENVAL file and returns data that can be plotted with ListPlot, the \
path in reciprocal space (in cartesian coordinates) and the eigenvalues \
grouped by k-point.\>\""}], "\n", 
 RowBox[{
  RowBox[{"CreateVaspBandstructurePlotDataSpinDep", "::", "usage"}], "=", 
  "\"\<{plotdataspin1,plotdataspin2,path,puredata}=\
CreateVaspBandstructurePlotDataSpinDep[file] reads a VASP EIGENVAL file and \
returns data that can be plotted with ListPlot, the path in reciprocal space \
(in cartesian coordinates) and the eigenvalues grouped by k-point (last may \
not work, check again!).\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateTBPlotData", "::", "usage"}], "=", 
  "\"\<CreateTBPlotData[function,path,substlist,nbands] creates a List, \
plottable with ListPlot, containing the band structure given by an orthogonal \
2D-Bloch-Hamiltonian f[kx,ky] along a path (generated by \
CreateTBPathfrom2DVaspPath or similar), replacing additional parameters \
according to substlist. nbands is the number of bands to calculate. The \
function uses parallelization.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotVaspBandstructure", "::", "usage"}], "=", 
  "\"\<PlotVaspBandstructure[file] plots a band structure, given by a VASP \
EIGENVAL file.\nPlotVaspBandstructure[file,plotstyle] takes a PlotStyle \
parameter.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateTBPlotData3D", "::", "usage"}], "=", 
  "\"\<CreateTBPlotData3D[function,path,substlist,nbands] creates a List, \
plottable with ListPlot, containing the band structure given by an orthogonal \
2D-Bloch-Hamiltonian f[kx,ky,kz] along a path (generated by \
CreateTBPathfrom3DVaspPath or similar), replacing additional parameters \
according to substlist. nbands is the number of bands to calculate. The \
function uses parallelization.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochMatrixFromWannier90", "::", "usage"}], "=", 
  "\"\<{matrix,structureplot,nbands}=BlochMatrixFromWannier90[file,\
latticevecs,dropatend] takes the file path to the wannier90_hr.dat file, the \
two lattice vectors and the number of outermost cells to ignore. It returns \
the Bloch-Hamiltonian (containing kx and ky as variables), a plot of the \
cells and the number of the bands.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlochMatrix3DFromWannier90", "::", "usage"}], "=", 
  "\"\<{matrix,nbands}=BlochMatrix3DFromWannier90[file,latticevecs,dropatend] \
takes the file path to the wannier90_hr.dat file, the lattice vectors and the \
number of outermost cells to ignore. It returns the Bloch-Hamiltonian \
(containing kx, ky and kz as variables) and the number of the bands.\>\""}], \
"\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotPROCARParts", "::", "usage"}], "=", 
  "\"\<PlotPROCARParts[file,atoms,orbitals,chargescaling] plots the portion \
of the DFT KS orbitals given by a list of orbitals. file is the path to the \
VASP PROCAR file, atoms is the list of atoms to include (e.g. 1;;7), orbitals \
ist the list of orbitals (e.g. 1;;9), chargescaling is a scaling factor (e.g. \
1/100).\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateTBPathfrom2DVaspPath", "::", "usage"}], "=", 
  "\"\<CreateTBPathfrom2DVaspPath[vasppath,recunitvecs] creates a path in the \
reciprocal space (in cartesian coordinates) from a VASP bandstructure. \
vasppath is the path generated by CreateVaspBandstructurePlotData (which is \
in direct coordinates), recunitvecs are the reciprocal unit vectors.\>\""}], \
"\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateTBPathfrom3DVaspPath", "::", "usage"}], "=", 
  "\"\<CreateTBPathfrom3DVaspPath[vasppath,recunitvecs] creates a path in the \
reciprocal space (in cartesian coordinates) from a VASP bandstructure. \
vasppath is the path generated by CreateVaspBandstructurePlotData (which is \
in direct coordinates), recunitvecs are the reciprocal unit vectors.\>\""}], \
"\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EasyBlochMatrixFromWannier90", "::", "usage"}], "=", 
  "\"\<EasyBlochMatrixFromWannier90[wannier90file,outcarfile] creates a Bloch \
Matrix (with parameters kx and ky as variables) from wannier90_hr.dat and \
OUTCAR input files.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EasyBlochMatrix3DFromWannier90", "::", "usage"}], "=", 
  "\"\<EasyBlochMatrix3DFromWannier90[wannier90file,outcarfile] creates a \
Bloch Matrix (with parameters kx,ky and kz as variables) from \
wannier90_hr.dat and OUTCAR input files.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CompareVaspWannier90Bandstructure", "::", "usage"}], "=", 
  "\"\<{vaspdata,wannier90bsdata}=CompareVaspWannier90Bandstructure[\
wannier90file,outcarfile,eigenvalfile] generates the bandstructure from a \
VASP calculation and a wannier90 calculation and returns data, plottable with \
ListPlot. Supply the paths to the files wannier90_hr.dat, OUTCAR and \
EIGENVAL.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CompareVaspWannier90Bandstructure3D", "::", "usage"}], "=", 
  "\"\<{vaspdata,wannier90bsdata}=CompareVaspWannier90Bandstructure3D[\
wannier90file,outcarfile,eigenvalfile] generates the bandstructure from a \
VASP calculation and a wannier90 calculation and returns data, plottable with \
ListPlot. Supply the paths to the files wannier90_hr.dat, OUTCAR and \
EIGENVAL.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HamiltonianMatrixElementsFromWannier90", "::", "usage"}], "=", 
  "\"\<{data,nbands}=HamiltonianMatrixElementsFromWannier90[file] returns the \
Hamiltonian matrix data contained in the file (as a list) and the number of \
bands.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReadCONTCAR", "::", "usage"}], "=", 
   "\"\<{atoms,latticevecs}=ReadCONTCAR[contcarfile] reads a VASP CONTCAR \
file (or a POSCAR file with the line \\\"Selective Dynamics\\\" and direct \
coordinates) and returns the positions of the atoms and the lattice \
vectors.\>\""}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.547034741515358*^9, {3.547035167198678*^9, 3.547035169908269*^9}, {
   3.547035702219915*^9, 3.547035713460804*^9}, 3.5470361111314077`*^9, {
   3.5470362329647617`*^9, 3.5470363635983458`*^9}, {3.547036452056918*^9, 
   3.547036537927403*^9}, {3.5470365694258747`*^9, 3.54703657812542*^9}, {
   3.5470366262594557`*^9, 3.547036706534011*^9}, {3.547037744028233*^9, 
   3.547038043799368*^9}, {3.547038287299034*^9, 3.5470382878336887`*^9}, {
   3.547039727635538*^9, 3.547039806293831*^9}, {3.547040288874728*^9, 
   3.5470402939746113`*^9}, {3.5470408119178343`*^9, 
   3.5470410701109953`*^9}, {3.547041169085658*^9, 3.547041199013311*^9}, {
   3.547041236929146*^9, 3.54704125249681*^9}, {3.547041679302146*^9, 
   3.5470417273248167`*^9}, {3.5470417761328793`*^9, 3.547041952281866*^9}, {
   3.547042012049168*^9, 3.547042015738123*^9}, {3.547278958303237*^9, 
   3.5472790372083073`*^9}, {3.547279075526108*^9, 3.5472791277009563`*^9}, {
   3.547279233489984*^9, 3.5472793064901543`*^9}, {3.547279351658255*^9, 
   3.547279363337619*^9}, {3.5472795936470137`*^9, 3.5472796050713177`*^9}, {
   3.547279654004587*^9, 3.54727974463571*^9}, {3.547288200302743*^9, 
   3.547288265864232*^9}, {3.5472902355950317`*^9, 3.547290277406473*^9}, {
   3.547885437952764*^9, 3.547885442960084*^9}, {3.5479904719272757`*^9, 
   3.547990514412601*^9}, {3.551604802076106*^9, 3.55160487212364*^9}, {
   3.551606317720625*^9, 3.55160631877789*^9}}],

Cell[CellGroupData[{

Cell["Funktionen VASP-Import, BZ-Pfade, Plotdaten, Fit", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.545050845128683*^9, 3.545050851244728*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlotVaspBandstructure", "[", "path_", "]"}], ":=", 
  RowBox[{"PlotVaspBandstructure", "[", 
   RowBox[{"path", ",", 
    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PlotVaspBandstructure", "[", 
   RowBox[{"path_", ",", "plotstyle_"}], "]"}], ":=", 
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"CreateVaspBandstructurePlotData", "[", "path", "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", "plotstyle"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.5470396383354473`*^9, 3.547039716569764*^9}, {
  3.5470402971732693`*^9, 3.54704029944878*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetLatticeFromOUTCAR", "[", "path_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data", ",", "datapos", ",", "directlatticevecs", ",", 
      "reclatticevecs"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"path", ",", "\"\<Table\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"datapos", "=", 
      RowBox[{
       RowBox[{"Last", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"data", ",", 
          RowBox[{"{", 
           RowBox[{
           "\"\<direct\>\"", ",", "\"\<lattice\>\"", ",", "\"\<vectors\>\"", 
            ",", "\"\<reciprocal\>\"", ",", "\"\<lattice\>\"", ",", 
            "\"\<vectors\>\""}], "}"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"directlatticevecs", "=", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"datapos", "+", "1"}], ";;", 
          RowBox[{"datapos", "+", "3"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"reclatticevecs", "=", 
      RowBox[{
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"datapos", "+", "1"}], ";;", 
          RowBox[{"datapos", "+", "3"}]}], "]"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"4", ";;", "6"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"directlatticevecs", ",", "reclatticevecs"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545822129462747*^9, 3.54582217813878*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"2", 
    RowBox[{"D", "/", "3"}], "D", " ", "is", " ", "both", " ", "used", " ", 
    "and", " ", "kind", " ", "of", " ", "mixed", " ", "up"}], "*)"}], "\n", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CreateTBPathfrom2DVaspPath", "[", 
      RowBox[{"vasppath_", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"VASP", " ", "path", " ", "in", " ", "BZ"}], ",", 
         RowBox[{
         "use", " ", "path", " ", "data", " ", "generated", " ", "by", " ", 
          "CreateVaspBandstructurePlotData"}]}], "*)"}], ",", 
       "recunitvecs_"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "List", " ", "of", " ", "2", " ", "reciprocal", " ", "unit", " ", 
         "vectors"}], ",", 
        RowBox[{"mind", " ", "the", " ", "ordering"}]}], "*)"}], "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "vasppoints", "}"}], ",", 
       RowBox[{
        RowBox[{"vasppoints", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", ".", "recunitvecs"}], "&"}], "/@", 
          RowBox[{"vasppath", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "i", "}"}], ",", 
            RowBox[{"vasppoints", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"vasppoints", "//", "Length"}]}], "}"}]}], "]"}]}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CreateTBPathfrom3DVaspPath", "[", 
      RowBox[{"vasppath_", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"VASP", " ", "path", " ", "in", " ", "BZ"}], ",", 
         RowBox[{
         "use", " ", "path", " ", "data", " ", "generated", " ", "by", " ", 
          "CreateVaspBandstructurePlotData"}]}], "*)"}], ",", 
       "recunitvecs_"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "List", " ", "of", " ", "3", " ", "reciprocal", " ", "unit", " ", 
         "vectors"}], ",", 
        RowBox[{"mind", " ", "the", " ", "ordering"}]}], "*)"}], "]"}], ":=", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "vasppoints", "}"}], ",", 
       RowBox[{
        RowBox[{"vasppoints", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"#", ".", "recunitvecs"}], "&"}], "/@", "vasppath"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "i", "}"}], ",", 
            RowBox[{"vasppoints", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"vasppoints", "//", "Length"}]}], "}"}]}], "]"}]}]}], 
      "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CreateVaspBandstructurePlotData", "[", "pfad_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "data", ",", "gridpoints", ",", "gridpoints2", ",", "toplot", ",", 
         "bandnr", ",", "path", ",", "puredata"}], "}"}], ",", 
       RowBox[{
        RowBox[{"data", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"pfad", ",", "\"\<Table\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"bandnr", "=", 
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"6", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"gridpoints", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"n", ";;", 
              RowBox[{"n", "+", "bandnr"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "8", ",", 
             RowBox[{"Length", "[", "data", "]"}], ",", 
             RowBox[{"bandnr", "+", "2"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"gridpoints2", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"n", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "2", ",", 
                RowBox[{"Length", "[", "#", "]"}]}], "}"}]}], "]"}], "&"}], 
           ",", "gridpoints"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"toplot", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"gridpoints2", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "m"}], "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "[", "gridpoints2", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"m", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"gridpoints2", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",",
            "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"path", "=", 
         RowBox[{"gridpoints", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1", ",", 
            RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"puredata", "=", 
         RowBox[{
          RowBox[{"gridpoints", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"2", ";;", 
              RowBox[{"bandnr", "+", "1"}]}]}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"toplot", ",", "path", ",", "puredata"}], "}"}]}]}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "return", " ", "value", " ", "contains", " ", "the", " ", "data", " ",
          "to", " ", "plot", " ", "ready", " ", "for", " ", "ListPlot", " ", 
         RowBox[{"(", 
          RowBox[{"first", " ", "list", " ", "entry"}], ")"}], " ", "as", " ",
          "well", " ", "as", " ", "the", " ", "path", " ", "in", " ", "the", 
         " ", "Brillouin", " ", "zone", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"second", " ", "list", " ", "entry"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"contains", " ", "points", " ", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}]}], ")"}], ".", 
          "To"}], " ", "plot", " ", "the", " ", "BS"}], ",", 
        RowBox[{"use", " ", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"CreateVaspBandstructurePlotData", "[", "path", "]"}], 
            "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ".", "The"}], " ", "third",
          " ", "entry", " ", "contains", " ", "only", " ", "the", " ", 
         "eigenvalues", " ", "grouped", " ", "by", " ", "k", " ", 
         RowBox[{"vector", "."}]}]}], "*)"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ShiftPlotData", "[", 
      RowBox[{"plotdata_", ",", "shift_"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"plotdata", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"plotdata", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "2"}], "]"}], "]"}], "+", "shift"}]}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"plotdata", "//", "Length"}]}], "}"}]}], "]"}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"constant", " ", "shift", " ", "for", " ", "BS"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "norbital2", " ", "und", " ", "basissize", " ", "mit", " ", "nbands", " ", 
     RowBox[{"ersetzt", "!!"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CreateTBPlotData", "[", 
      RowBox[{"function_", 
       RowBox[{"(*", 
        RowBox[{"Function", " ", 
         RowBox[{"f", "[", 
          RowBox[{"kx", ",", "ky"}], "]"}], " ", "that", " ", "generates", 
         " ", "Hamiltonian", " ", "as", " ", "a", " ", "function", " ", "of", 
         " ", "k"}], "*)"}], ",", "path_", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Path", " ", "through", " ", "Brillouin", " ", "zone"}], ",", 
         RowBox[{"List", " ", "of", " ", 
          RowBox[{"{", 
           RowBox[{"kx", ",", "ky"}], "}"}]}]}], "*)"}], ",", "substlist_", 
       RowBox[{"(*", 
        RowBox[{
        "Hamiltonian", " ", "function", " ", "variable", " ", "substitution", 
         " ", "list"}], "*)"}], ",", "nbands_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"{", "nbands", "}"}]}], "]"}], ",", 
                RowBox[{"Eigenvalues", "[", 
                 RowBox[{
                  RowBox[{"function", "[", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}], "/.", 
                  "substlist"}], " ", "]"}]}], "}"}], " ", "]"}], "&"}], ",", 
            "path"}], "]"}], "//", "Chop"}], ",", "1"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "creates", " ", "Band", " ", "structure", " ", "data", " ", "from", " ", 
      "Hamiltonian", " ", "and", " ", "path"}], ",", 
     RowBox[{"plottable", " ", "with", " ", "ListPlot"}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CreateTBPlotData3D", "[", 
      RowBox[{"function_", 
       RowBox[{"(*", 
        RowBox[{"Function", " ", 
         RowBox[{"f", "[", 
          RowBox[{"kx", ",", "ky"}], "]"}], " ", "that", " ", "generates", 
         " ", "Hamiltonian", " ", "as", " ", "a", " ", "function", " ", "of", 
         " ", "k"}], "*)"}], ",", "path_", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Path", " ", "through", " ", "Brillouin", " ", "zone"}], ",", 
         RowBox[{"List", " ", "of", " ", 
          RowBox[{"{", 
           RowBox[{"kx", ",", "ky"}], "}"}]}]}], "*)"}], ",", "substlist_", 
       RowBox[{"(*", 
        RowBox[{
        "Hamiltonian", " ", "function", " ", "variable", " ", "substitution", 
         " ", "list"}], "*)"}], ",", "nbands_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tmp", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"{", "nbands", "}"}]}], "]"}], ",", 
                RowBox[{"Eigenvalues", "[", 
                 RowBox[{
                  RowBox[{"function", "[", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], "/.", 
                  "substlist"}], " ", "]"}]}], "}"}], " ", "]"}], "&"}], ",", 
            "path"}], "]"}], "//", "Chop"}], ",", "1"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "creates", " ", "Band", " ", "structure", " ", "data", " ", "from", " ",
        "Hamiltonian", " ", "and", " ", "path"}], ",", 
      RowBox[{"plottable", " ", "with", " ", "ListPlot"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"same", " ", "thing"}], ",", 
      RowBox[{"but", " ", "with", " ", "overlap", " ", "matrix"}]}], "*)"}], 
    RowBox[{
     RowBox[{"CreateNOTBPlotData", "[", 
      RowBox[{"function_", 
       RowBox[{"(*", 
        RowBox[{"Function", " ", 
         RowBox[{"f", "[", 
          RowBox[{"kx", ",", "ky"}], "]"}], " ", "that", " ", "generates", 
         " ", "Hamiltonian", " ", "as", " ", "a", " ", "function", " ", "of", 
         " ", "k"}], "*)"}], ",", "SMatrix_", 
       RowBox[{"(*", 
        RowBox[{"Overlap", " ", "Matrix"}], "*)"}], ",", "path_", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Path", " ", "through", " ", "Brillouin", " ", "zone"}], ",", 
         RowBox[{"List", " ", "of", " ", 
          RowBox[{"{", 
           RowBox[{"kx", ",", "ky"}], "}"}]}]}], "*)"}], ",", "substlist_", 
       RowBox[{"(*", 
        RowBox[{
        "Hamiltonian", " ", "function", " ", "variable", " ", "substitution", 
         " ", "list"}], "*)"}], ",", "BasisSize_", ",", "Norbital2_"}], "]"}],
      ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tmp", ",", "tmp2"}], "}"}], ",", 
       RowBox[{
        RowBox[{"tmp", "=", 
         RowBox[{
          RowBox[{"function", "[", 
           RowBox[{"kx", ",", "ky"}], "]"}], "/.", "substlist"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tmp2", "=", 
         RowBox[{
          RowBox[{"SMatrix", "[", 
           RowBox[{"kx", ",", "ky"}], "]"}], "/.", "substlist"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Chop", "[", 
            RowBox[{"ParallelMap", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Norbital2", "*", "BasisSize"}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"Eigenvalues", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"tmp", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"kx", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                    RowBox[{"ky", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], ")"}], "//", 
                    "Chop"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"tmp2", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"kx", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                    RowBox[{"ky", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}]}], ")"}], "//", 
                    "Chop"}]}], "}"}], "]"}], "//", "Sort"}]}], "}"}], "]"}], 
               "&"}], ",", "path"}], "]"}], "]"}], "]"}], ",", "2"}], 
         "]"}]}]}], "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateTBdataForFit", "[", 
     RowBox[{"path_", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Path", " ", "through", " ", "Brillouin", " ", "zone"}], ",", 
        
        RowBox[{"List", " ", "of", " ", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}]}]}], "*)"}], ",", "substlist_"}], 
     RowBox[{"(*", 
      RowBox[{
      "Hamiltonian", " ", "function", " ", "variable", " ", "substitution", 
       " ", "list"}], "*)"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", ",", "tmp2"}], "}"}], ",", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"Bloch", "[", 
          RowBox[{"kx", ",", "ky"}], "]"}], "/.", "substlist"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp2", "=", 
        RowBox[{"path", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ParallelMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Eigenvalues", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"tmp", "/.", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"kx", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                   RowBox[{"ky", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], ")"}], "//", 
               "Chop"}], "]"}], "//", "Sort"}], ")"}], "&"}], ",", "tmp2"}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Method", "\[Rule]", "\"\<CoarsestGrained\>\""}]}], "*)"}],
          "]"}], "//", "Chop"}]}]}], "]"}]}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "creates", " ", "Band", " ", "structure", " ", "data", " ", "from", " ", 
      "Hamiltonian", " ", "and", " ", "path"}], ",", 
     RowBox[{"plottable", " ", "with", " ", "ListPlot"}]}], "*)"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CreateNOTBdataForFit", "[", 
     RowBox[{"path_", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Path", " ", "through", " ", "Brillouin", " ", "zone"}], ",", 
        
        RowBox[{"List", " ", "of", " ", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}]}]}], "*)"}], ",", "substlist_"}], 
     RowBox[{"(*", 
      RowBox[{
      "Hamiltonian", " ", "function", " ", "variable", " ", "substitution", 
       " ", "list"}], "*)"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", ",", "tmp2", ",", "tmp3"}], "}"}], ",", 
      RowBox[{
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"Bloch", "[", 
          RowBox[{"kx", ",", "ky"}], "]"}], "/.", "substlist"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp3", "=", 
        RowBox[{
         RowBox[{"BlochOverlap", "[", 
          RowBox[{"kx", ",", "ky"}], "]"}], "/.", "substlist"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tmp2", "=", 
        RowBox[{"path", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ParallelMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Eigenvalues", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"tmp", "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"kx", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"ky", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], ")"}], "//", 
                 "Chop"}], ",", 
                RowBox[{
                 RowBox[{"tmp3", "/.", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"kx", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"ky", "\[Rule]", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], "//", 
                 "Chop"}]}], "}"}], "]"}], "//", "Sort"}], ")"}], "&"}], ",", 
          "tmp2"}], 
         RowBox[{"(*", 
          RowBox[{",", 
           RowBox[{"Method", "\[Rule]", "\"\<CoarsestGrained\>\""}]}], "*)"}],
          "]"}], "//", "Chop"}]}]}], "]"}]}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "creates", " ", "Band", " ", "structure", " ", "data", " ", "from", " ", 
      "Hamiltonian", " ", "and", " ", "path"}], ",", 
     RowBox[{"plottable", " ", "with", " ", "ListPlot"}]}], "*)"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BandsOverallFitParameter", "[", 
     RowBox[{
     "bandnr_", ",", "path_", ",", "parlist_", ",", "vasppuredata_", ",", 
      "tbpuredatafct_"}], "]"}], ":=", 
    RowBox[{"Norm", "[", 
     RowBox[{
      RowBox[{"vasppuredata", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "bandnr"}], "]"}], "]"}], "-", 
      RowBox[{
       RowBox[{"tbpuredatafct", "[", 
        RowBox[{"path", ",", "parlist"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "bandnr"}], "]"}], "]"}]}], "]"}]}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SpecialFitWithDiracConeParameter", "[", 
      RowBox[{
      "bandnr_", ",", "path_", ",", "parlist_", ",", "vasppuredata_", ",", 
       "tbpuredatafct_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tb", "}"}], ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tb", "=", 
          RowBox[{"tbpuredatafct", "[", 
           RowBox[{"path", ",", "parlist"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"vasppuredata", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "bandnr"}], "]"}], "]"}], "-", 
            RowBox[{"tb", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "bandnr"}], "]"}], "]"}]}], "]"}], "+", 
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"vasppuredata", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"70", ";;", "180"}], ",", 
               RowBox[{"4", ";;", "5"}]}], "]"}], "]"}], "-", 
            RowBox[{"tb", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"70", ";;", "180"}], ",", 
               RowBox[{"4", ";;", "5"}]}], "]"}], "]"}]}], "]"}]}]}], ")"}]}],
       "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SpecialFitWithDiracConeParameter2", "[", 
      RowBox[{
      "bandnr_", ",", "path_", ",", "parlist_", ",", "vasppuredata_", ",", 
       "tbpuredatafct_"}], "]"}], 
     RowBox[{"(*", 
      RowBox[{
      "smaller", " ", "part", " ", "of", " ", "the", " ", "5", "th", " ", 
       "band"}], "*)"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "tb", "}"}], ",", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tb", "=", 
          RowBox[{"tbpuredatafct", "[", 
           RowBox[{"path", ",", "parlist"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"vasppuredata", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "bandnr"}], "]"}], "]"}], "-", 
            RowBox[{"tb", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "bandnr"}], "]"}], "]"}]}], "]"}], "+", 
          RowBox[{"Norm", "[", 
           RowBox[{
            RowBox[{"vasppuredata", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"90", ";;", "110"}], ",", 
               RowBox[{"4", ";;", "5"}]}], "]"}], "]"}], "-", 
            RowBox[{"tb", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"90", ";;", "110"}], ",", 
               RowBox[{"4", ";;", "5"}]}], "]"}], "]"}]}], "]"}]}]}], ")"}]}],
       "]"}]}], ";"}]}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545050816026122*^9, 3.545050853142474*^9}, {
  3.545055761861107*^9, 3.545055771050325*^9}, {3.5454002606765203`*^9, 
  3.5454002621743193`*^9}, {3.5458216321022043`*^9, 3.545821664422015*^9}, {
  3.545824591618927*^9, 3.545824617812273*^9}, {3.545826095949901*^9, 
  3.545826131853932*^9}, {3.547291991434276*^9, 3.547291999193849*^9}, {
  3.547292076970386*^9, 3.547292094541152*^9}, {3.547292271248858*^9, 
  3.54729246155165*^9}, {3.5472924993314466`*^9, 3.547292581540698*^9}, {
  3.547292620041999*^9, 3.547292729092876*^9}, {3.5472927650133266`*^9, 
  3.5472928060818644`*^9}, {3.5472928585307407`*^9, 3.547292920848001*^9}, {
  3.547292960566326*^9, 3.547292987868513*^9}, {3.547293028712243*^9, 
  3.547293038173677*^9}, {3.547293606719099*^9, 3.547293627027658*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReadCONTCAR", "[", "contcarfile_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "latticeconst", ",", "latticevecs", ",", "nratoms", ",", "atomsdirect", 
       ",", "atoms"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"poscar", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"contcarfile", ",", "\"\<Table\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"latticeconst", "=", 
       RowBox[{"poscar", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"latticevecs", "=", 
       RowBox[{"latticeconst", " ", 
        RowBox[{"poscar", "[", 
         RowBox[{"[", 
          RowBox[{"3", ";;", "5"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nratoms", "=", 
       RowBox[{"Plus", "@@", 
        RowBox[{"poscar", "[", 
         RowBox[{"[", "7", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"atomsdirect", "=", 
       RowBox[{"poscar", "[", 
        RowBox[{"[", 
         RowBox[{"10", ";;", 
          RowBox[{"10", "+", "nratoms", "-", "1"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"atoms", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"atomsdirect", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], " ", 
           RowBox[{"latticevecs", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "+", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"atomsdirect", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "2"}], "]"}], "]"}], " ", 
           RowBox[{"latticevecs", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "+", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"atomsdirect", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "3"}], "]"}], "]"}], " ", 
           RowBox[{"latticevecs", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "atomsdirect", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"atoms", ",", "latticevecs"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Funktionen EIGENVAL", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.545047735826545*^9, 3.545047738901589*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CreateVaspBandstructurePlotDataSpinDep", "[", "pfad_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "data", ",", "gridpoints", ",", "energy", ",", "toplot", ",", "bandnr", 
       ",", "path", ",", "puredata", ",", "energy2", ",", "toplot2"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"pfad", ",", "\"\<Table\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bandnr", "=", 
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"6", ",", "3"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"gridpoints", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"n", ";;", 
            RowBox[{"n", "+", "bandnr"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "8", ",", 
           RowBox[{"Length", "[", "data", "]"}], ",", 
           RowBox[{"bandnr", "+", "2"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"energy", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"n", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "2", ",", 
              RowBox[{"Length", "[", "#", "]"}]}], "}"}]}], "]"}], "&"}], ",",
          "gridpoints"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"energy2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"n", ",", "3"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "2", ",", 
              RowBox[{"Length", "[", "#", "]"}]}], "}"}]}], "]"}], "&"}], ",",
          "gridpoints"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"toplot", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"energy", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "m"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "energy", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"energy", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"toplot2", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"energy2", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "m"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "energy2", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"energy2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"path", "=", 
       RowBox[{"gridpoints", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1", ",", 
          RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"puredata", "=", 
       RowBox[{
        RowBox[{"gridpoints", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"2", ";;", 
            RowBox[{"bandnr", "+", "1"}]}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"toplot", ",", "toplot2", ",", "path", ",", "puredata"}], 
       "}"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "return", " ", "value", " ", "contains", " ", "the", " ", "data", " ", 
       "to", " ", "plot", " ", "ready", " ", "for", " ", "ListPlot", " ", 
       RowBox[{"(", 
        RowBox[{"first", " ", "list", " ", "entry"}], ")"}], " ", "as", " ", 
       "well", " ", "as", " ", "the", " ", "path", " ", "in", " ", "the", " ",
        "Brillouin", " ", "zone", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"second", " ", "list", " ", "entry"}], ";", 
          RowBox[{"contains", " ", "points", " ", 
           RowBox[{"{", 
            RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}]}]}], ")"}], ".", 
        "To"}], " ", "plot", " ", "the", " ", "BS"}], ",", 
      RowBox[{"use", " ", 
       RowBox[{
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"CreateVaspBandstructurePlotData", "[", "path", "]"}], "[", 
          
          RowBox[{"[", "1", "]"}], "]"}], "]"}], ".", "The"}], " ", "third", 
       " ", "entry", " ", "contains", " ", "only", " ", "the", " ", 
       "eigenvalues", " ", "grouped", " ", "by", " ", "k", " ", 
       RowBox[{"vector", "."}]}]}], "*)"}], "]"}]}], ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.54504547805694*^9, 3.545045478058074*^9}, {
  3.5450508770929728`*^9, 3.5450508842577*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SortBSDataForListLinePlot", "[", 
   RowBox[{"bsdata_", ",", "baender_", ",", "kpunkte_"}], "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"bsdata", "[", 
     RowBox[{"[", "j", "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "baender"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "i", ",", 
      RowBox[{"baender", " ", "kpunkte"}], ",", "baender"}], "}"}]}], 
   "]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545047755571085*^9, 3.545047756132547*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Funktionen PROCAR", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.5450477437630157`*^9, 3.5450477473715487`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VaspProjectionDataFromFile", "[", "pfad_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data", ",", "kpunkte", ",", "baender", ",", "atome", ",", "kpunktstart",
       ",", "bandstart", ",", "atomzeile", ",", "atomdata", ",", 
      "projectiondata", ",", "projectiondata2", ",", "singleatom"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"pfad", ",", "\"\<Table\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"kpunkte", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "4"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"baender", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "8"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"atome", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "12"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"singleatom", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"atome", "\[Equal]", "1"}], ",", "1", ",", "0"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"alle", " ", "zaehler", " ", "beginnen", " ", "mit", " ", "1"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kpunktstart", "[", "i_", 
       RowBox[{"(*", "kpunkt", "*)"}], "]"}], ":=", 
      RowBox[{"4", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"i", "-", "1"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"5", "-", "singleatom", "+", "atome"}], ")"}], " ", 
           "baender"}], "+", "3"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bandstart", "[", 
       RowBox[{"i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_"}], 
       RowBox[{"(*", "band", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"kpunktstart", "[", "i", "]"}], "+", "2", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"j", "-", "1"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"atome", "+", "5", "-", "singleatom"}], ")"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"atomzeile", "[", 
       RowBox[{"i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_", 
        RowBox[{"(*", "band", "*)"}], ",", "k_"}], 
       RowBox[{"(*", "atom", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"bandstart", "[", 
        RowBox[{"i", ",", "j"}], "]"}], "+", "2", "+", "k"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"atomdata", "[", 
       RowBox[{"data_", ",", "i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_", 
        RowBox[{"(*", "band", "*)"}], ",", "k_"}], 
       RowBox[{"(*", "atom", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"atomzeile", "[", 
           RowBox[{"i", ",", "j", ",", "k"}], "]"}], "]"}], "]"}], "//", 
        "Rest"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"projectiondata", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"atomdata", "[", 
           RowBox[{"data", ",", "i", ",", "j", ",", "k"}], "]"}], ",", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"bandstart", "[", 
              RowBox[{"i", ",", "j"}], "]"}], ",", "5"}], "]"}], "]"}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "kpunkte"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "baender"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "atome"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "projectiondata", ",", "kpunkte", ",", "baender", ",", "atome"}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545045989972447*^9, 3.545046011295632*^9}, {
  3.5456381940031643`*^9, 3.545638229013142*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VaspProjectionDataFromFileSpinDep", "[", "pfad_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data", ",", "kpunkte", ",", "baender", ",", "atome", ",", "kpunktstart",
       ",", "bandstart", ",", "atomzeile", ",", "kpunktstart2", ",", 
      "bandstart2", ",", "atomzeile2", ",", "atomdata", ",", "atomdata2", ",",
       "projectiondata", ",", "projectiondata2"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"pfad", ",", "\"\<Table\>\""}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"kpunkte", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "4"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"baender", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "8"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"atome", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "12"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"alle", " ", "zaehler", " ", "beginnen", " ", "mit", " ", "1"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kpunktstart", "[", "i_", 
       RowBox[{"(*", "kpunkt", "*)"}], "]"}], ":=", 
      RowBox[{"4", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"i", "-", "1"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"5", "+", "atome"}], ")"}], " ", "baender"}], "+", "3"}], 
         ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bandstart", "[", 
       RowBox[{"i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_"}], 
       RowBox[{"(*", "band", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"kpunktstart", "[", "i", "]"}], "+", "2", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"j", "-", "1"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"atome", "+", "5"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"atomzeile", "[", 
       RowBox[{"i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_", 
        RowBox[{"(*", "band", "*)"}], ",", "k_"}], 
       RowBox[{"(*", "atom", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"bandstart", "[", 
        RowBox[{"i", ",", "j"}], "]"}], "+", "2", "+", "k"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"kpunktstart2", "[", "i_", 
       RowBox[{"(*", "kpunkt", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"kpunktstart", "[", 
        RowBox[{"kpunkte", "+", "i"}], "]"}], "+", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bandstart2", "[", 
       RowBox[{"i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_"}], 
       RowBox[{"(*", "band", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"kpunktstart2", "[", "i", "]"}], "+", "2", "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"j", "-", "1"}], ")"}], " ", 
        RowBox[{"(", 
         RowBox[{"atome", "+", "5"}], ")"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"atomzeile2", "[", 
       RowBox[{"i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_", 
        RowBox[{"(*", "band", "*)"}], ",", "k_"}], 
       RowBox[{"(*", "atom", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"bandstart2", "[", 
        RowBox[{"i", ",", "j"}], "]"}], "+", "2", "+", "k"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"atomdata", "[", 
       RowBox[{"data_", ",", "i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_", 
        RowBox[{"(*", "band", "*)"}], ",", "k_"}], 
       RowBox[{"(*", "atom", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"atomzeile", "[", 
           RowBox[{"i", ",", "j", ",", "k"}], "]"}], "]"}], "]"}], "//", 
        "Rest"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"atomdata2", "[", 
       RowBox[{"data_", ",", "i_", 
        RowBox[{"(*", "kpunkt", "*)"}], ",", "j_", 
        RowBox[{"(*", "band", "*)"}], ",", "k_"}], 
       RowBox[{"(*", "atom", "*)"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"atomzeile2", "[", 
           RowBox[{"i", ",", "j", ",", "k"}], "]"}], "]"}], "]"}], "//", 
        "Rest"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"projectiondata", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"atomdata", "[", 
           RowBox[{"data", ",", "i", ",", "j", ",", "k"}], "]"}], ",", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"bandstart", "[", 
              RowBox[{"i", ",", "j"}], "]"}], ",", "5"}], "]"}], "]"}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "kpunkte"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "baender"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "atome"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"projectiondata2", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"atomdata2", "[", 
           RowBox[{"data", ",", "i", ",", "j", ",", "k"}], "]"}], ",", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"bandstart2", "[", 
              RowBox[{"i", ",", "j"}], "]"}], ",", "5"}], "]"}], "]"}]}], 
         "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "kpunkte"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "baender"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "atome"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "projectiondata", ",", "projectiondata2", ",", "kpunkte", ",", 
       "baender", ",", "atome"}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545045503695835*^9, 3.545045531800099*^9}, {
  3.5450457114925413`*^9, 3.5450457310126963`*^9}, {3.545045765842987*^9, 
  3.54504592225597*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PlotPROCARParts", "[", 
    RowBox[{"file_", ",", "atoms_", 
     RowBox[{"(*", "Liste", "*)"}], ",", "orbitals_", 
     RowBox[{"(*", "Liste", "*)"}], ",", "chargescaling_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "numbers", ",", "procar2dplotdata", ",", "content", ",", "nrbands", ",",
        "pos", ",", "projectiondata"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"projectiondata", "=", 
       RowBox[{
        RowBox[{"VaspProjectionDataFromFile", "[", "file", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nrbands", "=", 
       RowBox[{
        RowBox[{"projectiondata", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "//", "Length"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"numbers", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "projectiondata", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"procar2dplotdata", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pos", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"numbers", ",", 
              RowBox[{"projectiondata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "band", ",", "1", ",", "10"}], "]"}], 
               "]"}]}], "}"}], "//", "Transpose"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"content", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"PointSize", "[", 
              RowBox[{"#", "chargescaling"}], "]"}], "&"}], "/@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Apply", "[", 
                RowBox[{"Plus", ",", 
                 RowBox[{"Apply", "[", 
                  RowBox[{"Plus", ",", "#"}], "]"}]}], "]"}], "&"}], "/@", 
              RowBox[{"projectiondata", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "band", ",", "atoms", 
                 RowBox[{"(*", "atomnummern", "*)"}], ",", "orbitals"}], 
                RowBox[{"(*", "orbitalnummern", "*)"}], "]"}], "]"}]}], 
             ")"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"ConstantArray", "[", 
                RowBox[{
                 RowBox[{"Hue", "[", 
                  RowBox[{
                   RowBox[{"band", "/", "10."}], ",", "1", ",", "0.8"}], 
                  "]"}], ",", 
                 RowBox[{"Length", "[", "projectiondata", "]"}]}], "]"}], ",",
                "content", ",", 
               RowBox[{"Point", "/@", "pos"}]}], "}"}], "]"}], ",", "1"}], 
           "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"band", ",", "nrbands"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "procar2dplotdata"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545046853404853*^9, 3.545046960211968*^9}, {
  3.5450469963505287`*^9, 3.545047022782827*^9}, {3.54504708876969*^9, 
  3.545047132321781*^9}, {3.545047191148287*^9, 3.5450471928382463`*^9}, {
  3.54504743299747*^9, 3.545047462365965*^9}, {3.5456382051377687`*^9, 
  3.545638205617447*^9}, {3.547041635121512*^9, 3.547041665544322*^9}, {
  3.547042055621196*^9, 3.547042056470994*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BandPlotDataFromPROCARData", "[", "projectiondata_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"projectiondata", "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "i", ",", "1", ",", "10"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{
       RowBox[{"projectiondata", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "//", "Length"}]}], "}"}]}], 
   "]"}]}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545048955503161*^9, 3.545048957373002*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Funktionen wannier90", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.545050716514032*^9, 3.5450507215451*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"UnitCellSplit", "[", "data_", "]"}], ":=", 
   RowBox[{"GatherBy", "[", 
    RowBox[{"data", ",", 
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", "3"}], "]"}], "]"}], "&"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FindUnitCells", "[", 
    RowBox[{"data_", ",", "cellids_"}], "]"}], ":=", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"UnitCellSplit", "[", "data", "]"}], ",", 
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{"cellids", ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", 
           RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}], "]"}], "&"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"UseBands", "[", 
   RowBox[{"data_", ",", "bandnrs_"}], "]"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Span", ";;", 
     RowBox[{
      RowBox[{"doesn", "'"}], "t", " ", "work", " ", "for", " ", 
      "MemberQ"}]}], ",", 
    RowBox[{
    "so", " ", "use", " ", "explicit", " ", "Band", " ", "Nr", " ", "list", 
     " ", "or", " ", 
     RowBox[{"Range", "[", "]"}]}]}], "*)"}], ":=", 
  RowBox[{"Select", "[", 
   RowBox[{"data", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{"bandnrs", ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], "]"}], "&&", 
      RowBox[{"MemberQ", "[", 
       RowBox[{"bandnrs", ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "&"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetUnitCells", "[", "data_", "]"}], ":=", 
   RowBox[{"Union", "[", 
    RowBox[{"data", "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", 
       RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"UnitCells2GrapheneLattice", "[", 
   RowBox[{"unitcells_", ",", "latticeveca_", ",", "latticevecb_"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "+", 
         RowBox[{
          RowBox[{"1", "/", "3"}], " ", 
          RowBox[{"(", 
           RowBox[{"latticeveca", "+", "latticevecb"}], ")"}]}]}], ",", 
        RowBox[{"#", "+", 
         RowBox[{
          RowBox[{"2", "/", "3"}], " ", 
          RowBox[{"(", 
           RowBox[{"latticeveca", "+", "latticevecb"}], ")"}]}]}]}], "}"}], 
      "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"latticeveca", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "+", 
         RowBox[{"latticevecb", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "&"}], "/@", "unitcells"}], 
      ")"}]}], ",", "1"}], "]"}]}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.545050935114148*^9, 3.545050935114955*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BlochMatrixFromWannier90", "[", 
     RowBox[{"file_", ",", "latticevecs_", ",", "dropatend_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "data", ",", "rawdata", ",", "nbands", ",", "allunitcells", ",", 
        "hoppingvalues", ",", "elementnumbers", ",", "matrixasvector", ",", 
        "matrix", ",", "en", ",", "structureplot", ",", "linestart", ",", 
        "BlochH"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rawdata", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", "\"\<Table\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nbands", "=", 
        RowBox[{"rawdata", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"linestart", "=", 
        RowBox[{
         RowBox[{"Ceiling", "[", 
          RowBox[{
           RowBox[{"rawdata", "[", 
            RowBox[{"[", 
             RowBox[{"3", ",", "1"}], "]"}], "]"}], "/", "15"}], "]"}], "+", 
         "4"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"rawdata", "[", 
         RowBox[{"[", 
          RowBox[{"linestart", ";;"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"allunitcells", "=", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"UnitCellSplit", "[", "data", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1", ",", "All"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Norm", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"hoppingvalues", "=", 
        RowBox[{"FindUnitCells", "[", 
         RowBox[{"data", ",", 
          RowBox[{"Drop", "[", 
           RowBox[{"allunitcells", ",", 
            RowBox[{"-", "dropatend"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"elementnumbers", "=", 
        RowBox[{
         RowBox[{"hoppingvalues", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"4", ";;", "5"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"en", "=", "elementnumbers"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BlochH", "[", 
         RowBox[{"kx_", ",", "ky_"}], "]"}], ":=", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"matrixasvector", "=", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "7", "]"}], "]"}]}]}], ")"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{"I", " ", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"kx", ",", "ky"}], "}"}], ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"latticevecs", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", 
                    RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"latticevecs", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ",", 
                    RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], "]"}]}], 
                 "&"}], "/@", 
                RowBox[{"hoppingvalues", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"hoppingvalues", "//", "Length"}]}], "}"}]}], "]"}], 
             "//", "Chop"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"matrix", "=", 
            RowBox[{"Table", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "nbands"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "nbands"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"matrix", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"en", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
                 RowBox[{"en", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], "]"}], "=", 
              RowBox[{"matrixasvector", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"elementnumbers", "//", "Length"}]}], "}"}]}], "]"}], 
           ";", "\[IndentingNewLine]", "matrix"}]}], "\[IndentingNewLine]", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"structureplot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"UnitCells2GrapheneLattice", "[", 
             RowBox[{
              RowBox[{"allunitcells", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", 
              RowBox[{"latticevecs", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", 
              RowBox[{"latticevecs", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"UnitCells2GrapheneLattice", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Drop", "[", 
                RowBox[{"allunitcells", ",", 
                 RowBox[{"-", "dropatend"}]}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", 
              RowBox[{"latticevecs", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", 
              RowBox[{"latticevecs", "[", 
               RowBox[{"[", 
                RowBox[{"2", ",", 
                 RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], "]"}]}], "}"}], 
          ",", 
          RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "30"}], ",", "30"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "30"}], ",", "30"}], "}"}]}], "}"}]}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"PointSize", "[", "Large", "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"BlochH", ",", "structureplot", ",", "nbands"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HamiltonianMatrixElementsFromWannier90", "[", "file_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "rawdata", ",", "nbands", ",", "linestart", ",", "allunitcells", ",", 
        "data"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rawdata", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", "\"\<Table\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nbands", "=", 
        RowBox[{"rawdata", "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"linestart", "=", 
        RowBox[{
         RowBox[{"Ceiling", "[", 
          RowBox[{
           RowBox[{"rawdata", "[", 
            RowBox[{"[", 
             RowBox[{"3", ",", "1"}], "]"}], "]"}], "/", "15"}], "]"}], "+", 
         "4"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"data", "=", 
        RowBox[{"rawdata", "[", 
         RowBox[{"[", 
          RowBox[{"linestart", ";;"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"data", ",", "nbands"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlochMatrix3DFromWannier90", "[", 
    RowBox[{"file_", ",", "latticevecs_", ",", "dropatend_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "data", ",", "rawdata", ",", "nbands", ",", "allunitcells", ",", 
       "hoppingvalues", ",", "elementnumbers", ",", "matrixasvector", ",", 
       "matrix", ",", "en", ",", "structureplot", ",", "linestart", ",", 
       "BlochH"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rawdata", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"file", ",", "\"\<Table\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nbands", "=", 
       RowBox[{"rawdata", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"linestart", "=", 
       RowBox[{
        RowBox[{"Ceiling", "[", 
         RowBox[{
          RowBox[{"rawdata", "[", 
           RowBox[{"[", 
            RowBox[{"3", ",", "1"}], "]"}], "]"}], "/", "15"}], "]"}], "+", 
        "4"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"rawdata", "[", 
        RowBox[{"[", 
         RowBox[{"linestart", ";;"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"allunitcells", "=", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"UnitCellSplit", "[", "data", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1", ",", "All"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"Norm", "[", 
           RowBox[{"#", ",", "1"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"hoppingvalues", "=", 
       RowBox[{"FindUnitCells", "[", 
        RowBox[{"data", ",", 
         RowBox[{"Drop", "[", 
          RowBox[{"allunitcells", ",", 
           RowBox[{"-", "dropatend"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"elementnumbers", "=", 
       RowBox[{
        RowBox[{"hoppingvalues", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"4", ";;", "5"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"en", "=", "elementnumbers"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"BlochH", "[", 
        RowBox[{"kx_", ",", "ky_", ",", "kz_"}], "]"}], ":=", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"matrixasvector", "=", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "6", "]"}], "]"}], "+", 
                   RowBox[{"I", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "7", "]"}], "]"}]}]}], ")"}], " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"kx", ",", "ky", ",", "kz"}], "}"}], ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"latticevecs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"latticevecs", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"latticevecs", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}]}], "]"}]}], 
                "&"}], "/@", 
               RowBox[{"hoppingvalues", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"hoppingvalues", "//", "Length"}]}], "}"}]}], "]"}], "//",
             "Chop"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"matrix", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "nbands"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "nbands"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"matrix", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"en", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
                RowBox[{"en", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "]"}], "]"}], "=", 
             
             RowBox[{"matrixasvector", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"elementnumbers", "//", "Length"}]}], "}"}]}], "]"}], 
          ";", "\[IndentingNewLine]", "matrix"}]}], "\[IndentingNewLine]", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"BlochH", ",", "nbands"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5450556152962933`*^9, 3.545055633426667*^9}, {
   3.5458224931380672`*^9, 3.545822509015896*^9}, {3.5458225693830643`*^9, 
   3.545822695561111*^9}, {3.5458228143455687`*^9, 3.545822843557246*^9}, {
   3.5458231949153423`*^9, 3.545823233213312*^9}, {3.5458256408681602`*^9, 
   3.545825736689147*^9}, {3.54582579396875*^9, 3.5458257974897842`*^9}, {
   3.5458260269847393`*^9, 3.545826036212405*^9}, 3.545834322489975*^9, {
   3.547290922868338*^9, 3.547290934576847*^9}, {3.547291226357272*^9, 
   3.5472912271712227`*^9}, {3.547291298153947*^9, 3.547291298407811*^9}, {
   3.547291496842448*^9, 3.547291603709545*^9}, {3.547291683199395*^9, 
   3.5472916923442717`*^9}, {3.547291726469536*^9, 3.547291739793847*^9}, {
   3.5472917718796043`*^9, 3.547291777638253*^9}, {3.5472918183113527`*^9, 
   3.54729182843817*^9}, {3.547293270760167*^9, 3.547293344756542*^9}, {
   3.547885310254039*^9, 3.547885348414834*^9}, {3.547885392260037*^9, 
   3.547885414610708*^9}, {3.547885922381899*^9, 3.547885925951803*^9}, {
   3.5478859695747843`*^9, 3.547886003105528*^9}, {3.547886082271999*^9, 
   3.547886092837349*^9}, 3.547886130253316*^9, {3.5478861664709883`*^9, 
   3.5478861668100367`*^9}, {3.547990457791862*^9, 3.5479904617032824`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EasyBlochMatrixFromWannier90", "[", 
    RowBox[{"wannier90file_", ",", "outcarfile_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "matrix", ",", "lattice", ",", "reclattice", ",", "structureplot", ",", 
       "nbands"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lattice", ",", "reclattice"}], "}"}], "=", 
       RowBox[{"GetLatticeFromOUTCAR", "[", "outcarfile", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"matrix", ",", "structureplot", ",", "nbands"}], "}"}], "=", 
       RowBox[{"BlochMatrixFromWannier90", "[", 
        RowBox[{"wannier90file", ",", "lattice", ",", "0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "matrix"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.547278187893511*^9, 3.547278326262241*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EasyBlochMatrix3DFromWannier90", "[", 
    RowBox[{"wannier90file_", ",", "outcarfile_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"matrix", ",", "lattice", ",", "reclattice", ",", "nbands"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lattice", ",", "reclattice"}], "}"}], "=", 
       RowBox[{"GetLatticeFromOUTCAR", "[", "outcarfile", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"matrix", ",", "nbands"}], "}"}], "=", 
       RowBox[{"BlochMatrix3DFromWannier90", "[", 
        RowBox[{"wannier90file", ",", "lattice", ",", "0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "matrix"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.547278359949587*^9, 3.547278390205946*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CompareVaspWannier90Bandstructure", "[", 
    RowBox[{"wannier90file_", ",", "outcarfile_", ",", "eigenvalfile_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "lattice", ",", "reclattice", ",", "vaspdata", ",", "vasppath", ",", 
       "vasppuredata", ",", "path", ",", "blochh", ",", "structureplot", ",", 
       "nbands", ",", "wannier90bsdata"}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lattice", ",", "reclattice"}], "}"}], "=", 
       RowBox[{"GetLatticeFromOUTCAR", "[", "outcarfile", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"vaspdata", ",", "vasppath", ",", "vasppuredata"}], "}"}], 
       "=", 
       RowBox[{
       "CreateVaspBandstructurePlotData", "[", "eigenvalfile", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"path", "=", 
       RowBox[{"CreateTBPathfrom2DVaspPath", "[", 
        RowBox[{"vasppath", ",", 
         RowBox[{"2", "\[Pi]", " ", 
          RowBox[{"reclattice", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"1", ";;", "2"}], ",", 
             RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"blochh", ",", "structureplot", ",", "nbands"}], "}"}], "=", 
       RowBox[{"BlochMatrixFromWannier90", "[", 
        RowBox[{"wannier90file", ",", "lattice", ",", "0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wannier90bsdata", "=", 
       RowBox[{"CreateTBPlotData", "[", 
        RowBox[{"blochh", ",", "path", ",", 
         RowBox[{"{", "}"}], ",", "nbands"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"vaspdata", ",", "wannier90bsdata"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.547278419998061*^9, 3.547278514729754*^9}, {
  3.547278566149219*^9, 3.547278579362105*^9}, {3.5472786752870617`*^9, 
  3.547278739142826*^9}, {3.547293917242325*^9, 3.547293943494647*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CompareVaspWannier90Bandstructure3D", "[", 
    RowBox[{"wannier90file_", ",", "outcarfile_", ",", "eigenvalfile_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "lattice", ",", "reclattice", ",", "vaspdata", ",", "vasppath", ",", 
       "vasppuredata", ",", "path", ",", "blochh", ",", "structureplot", ",", 
       "nbands", ",", "wannier90bsdata"}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lattice", ",", "reclattice"}], "}"}], "=", 
       RowBox[{"GetLatticeFromOUTCAR", "[", "outcarfile", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"vaspdata", ",", "vasppath", ",", "vasppuredata"}], "}"}], 
       "=", 
       RowBox[{
       "CreateVaspBandstructurePlotData", "[", "eigenvalfile", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"path", "=", 
       RowBox[{"CreateTBPathfrom3DVaspPath", "[", 
        RowBox[{"vasppath", ",", 
         RowBox[{"2", "\[Pi]", " ", "reclattice"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"blochh", ",", "nbands"}], "}"}], "=", 
       RowBox[{"BlochMatrix3DFromWannier90", "[", 
        RowBox[{"wannier90file", ",", "lattice", ",", "0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wannier90bsdata", "=", 
       RowBox[{"CreateTBPlotData3D", "[", 
        RowBox[{"blochh", ",", "path", ",", 
         RowBox[{"{", "}"}], ",", "nbands"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"vaspdata", ",", "wannier90bsdata"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5472788034186563`*^9, 3.547278856559786*^9}, {
  3.547293930149235*^9, 3.547293945843851*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.547035734347958*^9, 3.54703573457987*^9}, 
   3.54703577630091*^9}],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{
  RowBox[{"Protect", "@@", 
   RowBox[{"Names", "[", "\"\<dftanalysis`*\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{3.547035930813974*^9, 3.54703600372397*^9}]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{961, 946},
WindowMargins->{{Automatic, -3}, {Automatic, 0}},
ShowSelection->True,
FrontEndVersion->"8.0 for Linux x86 (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[400, 13, 696, 13, 69, "Input",
 InitializationCell->True],
Cell[1099, 28, 8179, 137, 1532, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[9303, 169, 167, 2, 28, "Subsubsection",
 InitializationGroup->True],
Cell[9473, 173, 730, 17, 69, "Input"],
Cell[10206, 192, 1873, 51, 164, "Input",
 InitializationGroup->True],
Cell[12082, 245, 25985, 671, 1836, "Input",
 InitializationGroup->True],
Cell[38070, 918, 2407, 64, 221, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40514, 987, 138, 2, 28, "Subsubsection",
 InitializationGroup->True],
Cell[40655, 991, 5568, 145, 259, "Input",
 InitializationGroup->True],
Cell[46226, 1138, 554, 15, 30, "Input",
 InitializationGroup->True]
}, Closed]],
Cell[CellGroupData[{
Cell[46817, 1158, 140, 2, 22, "Subsubsection",
 InitializationGroup->True],
Cell[46960, 1162, 4289, 113, 430, "Input",
 InitializationGroup->True],
Cell[51252, 1277, 6545, 172, 582, "Input",
 InitializationGroup->True],
Cell[57800, 1451, 3522, 83, 278, "Input",
 InitializationGroup->True],
Cell[61325, 1536, 549, 15, 50, "Input",
 InitializationGroup->True]
}, Closed]],
Cell[CellGroupData[{
Cell[61911, 1556, 137, 2, 22, "Subsubsection",
 InitializationGroup->True],
Cell[62051, 1560, 2896, 90, 183, "Input",
 InitializationGroup->True],
Cell[64950, 1652, 16199, 396, 1171, "Input",
 InitializationGroup->True],
Cell[81152, 2050, 971, 24, 126, "Input"],
Cell[82126, 2076, 923, 23, 126, "Input"],
Cell[83052, 2101, 2176, 53, 202, "Input"],
Cell[85231, 2156, 1894, 47, 202, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[87162, 2208, 143, 3, 22, "Subsubsection",
 InitializationGroup->True],
Cell[87308, 2213, 297, 7, 69, "Input",
 InitializationGroup->True]
}, Open  ]]
}
]
*)

