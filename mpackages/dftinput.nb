(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     54685,       1346]
NotebookOptionsPosition[     53302,       1298]
NotebookOutlinePosition[     53673,       1314]
CellTagsIndexPosition[     53630,       1311]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"BeginPackage", "[", "\"\<dftinput`\>\"", "]"}], "\n", 
 RowBox[{
  RowBox[{"Unprotect", "@@", 
   RowBox[{"Names", "[", "\"\<dftinput`*\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "@@", 
   RowBox[{"Names", "[", "\"\<dftinput`*\>\"", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.547026674311408*^9, 3.54702667431256*^9}, {
  3.54702892147016*^9, 3.5470289272344637`*^9}, {3.547029194953753*^9, 
  3.5470291954850683`*^9}, {3.547030454603084*^9, 3.547030484364112*^9}, {
  3.547034633494515*^9, 3.54703464787747*^9}, {3.5470347198154783`*^9, 
  3.5470347399704514`*^9}, {3.547035924828367*^9, 3.54703592964351*^9}, {
  3.5476534896947403`*^9, 3.547653493760332*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gnrbasis", "::", "usage"}], "=", 
  "\"\<gnrbasis[rings] returns the coordinates of the carbon atoms contained \
in a single slice of a zigzag graphene nanoribbon with a given width (number \
of rings).\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gnrbasiswithh", "::", "usage"}], "=", 
  "\"\<gnrbasiswithh[rings] returns the coordinates of the carbon and \
hydrogen atoms contained in a single slice of a hydrogen-passivated zigzag \
graphene nanoribbon with a given width (number of rings). The last two \
coordinates are those of the hydrogen atoms.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"generategnrfrombasis", "::", "usage"}], "=", 
  "\"\<generategnrfrombasis[basis,ribbonlength] returns the coordinates of \
the atoms in a zigzag GNR which contains ribbonlength copies of the given \
basis (e.g. created with gnrbasis[]).\>\""}], "\n", 
 RowBox[{
  RowBox[{"PointBetweenAtoms2D", "::", "usage"}], "=", 
  "\"\<PointBetweenAtoms2D[points,latticevecs,neighbourthreshold] returns a \
list of the points at the half distance between neighbouring atoms. The \
crystal lattice is given by points and latticevecs. Two points are considered \
neighbours if their distance is smaller than or equal to neighbourthreshold \
(e.g. GrapheneLatticeConstant).\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AddZeroInThirdDimension", "::", "usage"}], " ", "=", 
  "\"\<AddZeroInThirdDimension[list] adds a third column with zeroes to a \
list of 2D-Vectors.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GrapheneLatticeConstant", "::", "usage"}], "=", 
  "\"\<Lattice constant of Graphene.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendGNRInitialGuess", "::", "usage"}], "=", 
  "\"\<AppendGNRInitialGuess[gnrwidth,wannier90file] appends the initial \
guesses (the \\\"begin projections\\\" section) for the Wannier orbitals of a \
zigzag-GNR with a width of gnrwidth rings to the file wannier90file (e.g. \
wannier90.win). The atoms are assumed at the positions generated by \
GenerateGNRPOSCAR[]. The orbital number num_wann is also appended.\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AppendGNRhydrogenInitialGuess", "::", "usage"}], "=", 
  "\"\<AppendGNRhydrogenInitialGuess[gnrwidth,wannier90file] appends the \
initial guesses (the \\\"begin projections\\\" section) for the Wannier \
orbitals of a zigzag-GNR with hydrogen-passivated edges with a width of \
gnrwidth rings to the file wannier90file (e.g. wannier90.win). The atoms are \
assumed at the positions generated by GenerateGNRhydrogenPOSCAR[]. The \
orbital number num_wann is also appended.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GenerateGNRPOSCAR", "::", "usage"}], "=", 
  "\"\<GenerateGNRPOSCAR[gnrwidth,yspacing,zspacing,POSCARfile] generates a \
POSCAR file describing a GNR with gnrwidth rings in width. yspacing and \
zspacing  is the additional spacing in the box (e.g. 20). A list of the \
positions of the orbitals is returned.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GenerateGNRhydrogenPOSCAR", "::", "usage"}], "=", 
  "\"\<GenerateGNRhydrogenPOSCAR[gnrwidth,yspacing,zspacing,POSCARfile] \
generates a POSCAR file describing a zigzag-GNR with hydrogen-passivated \
edges with gnrwidth rings in width. yspacing and zspacing  is the additional \
spacing in the box (e.g. 20). The file contains appropriate parameters \
(except for acenes) for a relaxation (with NSW and IBRION parameters in the \
INCAR file); the outmost two carbon atoms (on each side) and the hydrogen \
atom are being relaxed. The last two coordinates are those of the hydrogen \
atoms (so the POTCAR file has to contain the carbon first, then the \
hydrogen). A list of the positions of the orbitals is returned.\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.547034741515358*^9, {3.547035167198678*^9, 3.547035169908269*^9}, {
   3.547035702219915*^9, 3.547035713460804*^9}, 3.5470361111314077`*^9, {
   3.5470362329647617`*^9, 3.5470363635983458`*^9}, {3.547036452056918*^9, 
   3.547036537927403*^9}, {3.5470365694258747`*^9, 3.54703657812542*^9}, {
   3.5470366262594557`*^9, 3.547036706534011*^9}, {3.547037744028233*^9, 
   3.547038043799368*^9}, {3.547038287299034*^9, 3.5470382878336887`*^9}, {
   3.547039727635538*^9, 3.547039806293831*^9}, {3.547040288874728*^9, 
   3.5470402939746113`*^9}, {3.5470408119178343`*^9, 
   3.5470410701109953`*^9}, {3.547041169085658*^9, 3.547041199013311*^9}, {
   3.547041236929146*^9, 3.54704125249681*^9}, {3.547041679302146*^9, 
   3.5470417273248167`*^9}, {3.5470417761328793`*^9, 3.547041952281866*^9}, {
   3.547042012049168*^9, 3.547042015738123*^9}, {3.547278958303237*^9, 
   3.5472790372083073`*^9}, {3.547279075526108*^9, 3.5472791277009563`*^9}, {
   3.547279233489984*^9, 3.5472793064901543`*^9}, {3.547279351658255*^9, 
   3.547279363337619*^9}, {3.5472795936470137`*^9, 3.5472796050713177`*^9}, {
   3.547279654004587*^9, 3.54727974463571*^9}, {3.547288200302743*^9, 
   3.547288265864232*^9}, {3.5472902355950317`*^9, 3.547290277406473*^9}, {
   3.5476534463190813`*^9, 3.547653447015617*^9}, {3.547653589581191*^9, 
   3.5476536602145643`*^9}, {3.5476538094052687`*^9, 3.547653912582408*^9}, {
   3.547653981424736*^9, 3.547654153759327*^9}, {3.5476542026697474`*^9, 
   3.547654288093917*^9}, {3.547654632525432*^9, 3.5476546461659803`*^9}, {
   3.547742770488305*^9, 3.5477427789668207`*^9}, {3.5477447877500234`*^9, 
   3.547744881308617*^9}, {3.547744965541039*^9, 3.547744999480492*^9}, {
   3.5477491972539296`*^9, 3.547749332089867*^9}, {3.547749829333031*^9, 
   3.547749840501*^9}, {3.548417278815339*^9, 3.548417336655759*^9}, {
   3.5484198803464327`*^9, 3.54841999585295*^9}, {3.548420498948107*^9, 
   3.548420511648313*^9}, 3.5515966945506477`*^9, {3.552285951145059*^9, 
   3.552285951968567*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.548419881756317*^9}],

Cell[CellGroupData[{

Cell["Global variables", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.547653464255418*^9, 3.5476534649216423`*^9}, {
  3.547653506819482*^9, 3.5476535092077*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"length", "=", 
   RowBox[{"2.461", "/", 
    SqrtBox["3"]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogendistance", "=", "1.1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GrapheneLatticeConstant", "=", "length"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a", "=", 
   RowBox[{"length", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       SqrtBox["3"], "/", "2"}], ",", 
      RowBox[{"3", "/", "2"}]}], "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "=", 
   RowBox[{"length", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        SqrtBox["3"]}], "/", "2"}], ",", 
      RowBox[{"3", "/", "2"}]}], "}"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5359651253198357`*^9, 3.5359651442442493`*^9}, {
  3.535965216280097*^9, 3.5359652289800043`*^9}, {3.5429829495595703`*^9, 
  3.5429829496640625`*^9}, {3.5429829846757812`*^9, 3.542983019963867*^9}, {
  3.547654618811447*^9, 3.5476546292290897`*^9}, {3.548417344047798*^9, 
  3.5484173484787273`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"unit", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {
       RowBox[{"1.", "/", "3"}], 
       RowBox[{"1.", "/", "3"}]},
      {
       RowBox[{"2.", "/", "3"}], 
       RowBox[{"2.", "/", "3"}]}
     }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kpath", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"0", "0"},
      {
       RowBox[{"1.", "/", "3"}], 
       RowBox[{
        RowBox[{"-", "1."}], "/", "3"}]},
      {
       RowBox[{"1.", "/", "2"}], "0"}
     }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kpath2", "=", 
   RowBox[{"(", "\[NoBreak]", GridBox[{
      {"0", "0"},
      {"0.5", "0"}
     }], "\[NoBreak]", ")"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.535965155267667*^9, 3.5359652076240873`*^9}, {
   3.5359652395844173`*^9, 3.535965262119854*^9}, {3.53596616551572*^9, 
   3.535966165972005*^9}, 3.5359665002452803`*^9, {3.535966563816946*^9, 
   3.535966611224822*^9}, {3.5359690203067513`*^9, 3.5359690628722773`*^9}, {
   3.535969865884761*^9, 3.5359698733444233`*^9}, {3.5429830595439453`*^9, 
   3.54298306475*^9}, {3.545056892920053*^9, 3.545056911255445*^9}, 
   3.5461867324785156`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.53596692857615*^9, 3.5359669295692883`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"unitWithShift", "[", 
    RowBox[{"ashift_", ",", "bshift_"}], "]"}], ":=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"unit", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "+", "ashift"}], ",", 
      RowBox[{
       RowBox[{"unit", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "+", "bshift"}]}], "}"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"unitWithShift", "[", "shifts_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Apply", "[", 
      RowBox[{"unitWithShift", ",", "shifts", ",", "1"}], "]"}], ",", "1"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DirectToCartesian", "[", "points_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "a"}], "+", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], " ", "b"}]}], "&"}], "/@", 
    "points"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CreateAllNumbersInBaseWithLength", "[", 
    RowBox[{"base_", ",", "length_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"IntegerDigits", "[", 
      RowBox[{"#", ",", "base", ",", "length"}], "]"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"0", ",", 
      RowBox[{
       SuperscriptBox["base", "length"], "-", "1"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AddZeroInThirdDimension", "[", "list_", "]"}], ":=", 
  RowBox[{"Transpose", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Transpose", "[", "list", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0.", "&"}], "/@", "list"}], "}"}]}], "}"}], ",", "1"}], 
    "]"}], "]"}], " "}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5359655892369432`*^9, 3.5359656457589617`*^9}, {
   3.535965698758832*^9, 3.535965721820601*^9}, {3.5359658824792423`*^9, 
   3.5359659020018167`*^9}, {3.53596611152363*^9, 3.535966115685032*^9}, {
   3.535966354155623*^9, 3.535966435311013*^9}, {3.5359696162084103`*^9, 
   3.535969638368847*^9}, 3.5359704236926203`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExportListToFile", "[", 
    RowBox[{"file_", ",", "list_"}], "]"}], ":=", 
   RowBox[{"Export", "[", 
    RowBox[{"file", ",", "list", ",", "\"\<Table\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportListToFileWithCommas", "[", 
    RowBox[{"file_", ",", "list_"}], "]"}], ":=", 
   RowBox[{"Export", "[", 
    RowBox[{"file", ",", "list", ",", "\"\<Table\>\"", ",", 
     RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<,\>\""}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExportListToFileNoSep", "[", 
    RowBox[{"file_", ",", "list_"}], "]"}], ":=", 
   RowBox[{"Export", "[", 
    RowBox[{"file", ",", "list", ",", "\"\<Table\>\"", ",", 
     RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5453854817708187`*^9, 3.545385512777422*^9}, {
  3.5461959483203125`*^9, 3.546195972095703*^9}, {3.5461965552910156`*^9, 
  3.5461965636015625`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"gnrbasis", "[", "rings_", "]"}], ":=", 
   RowBox[{"Rest", "[", 
    RowBox[{"Drop", "[", 
     RowBox[{
      RowBox[{"DirectToCartesian", "[", 
       RowBox[{"unitWithShift", "[", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"n", ",", 
                  RowBox[{"n", "-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "n"}], "}"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", 
                RowBox[{"Ceiling", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"rings", "+", "1"}], ")"}], "/", "2"}], "]"}]}], 
               "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}]}], "]"}], "]"}], "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"EvenQ", "[", "rings", "]"}], ",", 
        RowBox[{"-", "3"}], ",", 
        RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}]}], ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5430396887290707`*^9, 3.543039697358099*^9}, {
   3.543039907669958*^9, 3.5430399230860653`*^9}, 3.543039968923483*^9, {
   3.5430400455113173`*^9, 3.543040051583611*^9}, {3.543040469404007*^9, 
   3.543040619294191*^9}, {3.543040751380258*^9, 3.543040776075569*^9}, 
   3.548417369024817*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"gnrbasiswithh", "[", "rings_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "gnrorig", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gnrorig", "=", 
       RowBox[{"gnrbasis", "[", "rings", "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"Join", "[", 
       RowBox[{"gnrorig", ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"First", "[", "gnrorig", "]"}], "-", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "hydrogendistance"}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Last", "[", "gnrorig", "]"}], "+", 
           RowBox[{"{", 
            RowBox[{"0.", ",", "hydrogendistance"}], "}"}]}]}], 
         "\[IndentingNewLine]", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5430396887290707`*^9, 3.543039697358099*^9}, {
   3.543039907669958*^9, 3.5430399230860653`*^9}, 3.543039968923483*^9, {
   3.5430400455113173`*^9, 3.543040051583611*^9}, {3.543040469404007*^9, 
   3.543040619294191*^9}, {3.543040751380258*^9, 3.543040776075569*^9}, {
   3.548417369024817*^9, 3.5484173746385*^9}, {3.548417416818239*^9, 
   3.548417437948477*^9}, {3.54841749450249*^9, 3.548417645543522*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"generategnrfrombasis", "[", 
    RowBox[{"basis_", ",", "ribbonlength_"}], "]"}], ":=", 
   RowBox[{"generategnrfrombasis", "[", 
    RowBox[{
     RowBox[{"length", 
      SqrtBox["3"]}], ",", "basis", ",", "ribbonlength"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generategnrfrombasis", "[", 
    RowBox[{"latticeconst_", ",", "basis_", ",", "ribbonlength_"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"basis", "+", 
      RowBox[{"n", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"latticeconst", ",", "0"}], "}"}], ",", 
         RowBox[{"Length", "[", "basis", "]"}]}], "]"}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "ribbonlength"}], "}"}]}], "]"}]}], ";"}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.543040133637323*^9, 3.5430402331072893`*^9}, {
  3.547653738573456*^9, 3.5476538011648006`*^9}, {3.547653920172626*^9, 
  3.547653921800252*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PointBetweenAtoms2D", "[", 
     RowBox[{"points_", ",", "latticevecs_", ",", "neighbourthreshold_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "lotsofpoints", ",", "connections", ",", "selectedconnections", ",", 
        "selectedconnections2", ",", "WithinRange"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"WithinRange", "[", "point_", "]"}], ":=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ".", "point"}], "<", 
            SuperscriptBox[
             RowBox[{"Norm", "[", 
              RowBox[{"latticevecs", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "2"]}], "&&", 
           RowBox[{
            RowBox[{
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ".", "point"}], "<", 
            SuperscriptBox[
             RowBox[{"Norm", "[", 
              RowBox[{"latticevecs", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "2"]}], "&&", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ".", "point"}], ">=", "0"}], "&&",
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ".", "point"}], ">=", "0"}]}], 
          "\[IndentingNewLine]", ",", "True", ",", "False"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"lotsofpoints", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"points", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "+", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "-", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "+", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "-", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "+", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "+", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "-", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "-", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"connections", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", "j", ",", 
              RowBox[{
               RowBox[{"lotsofpoints", "[", 
                RowBox[{"[", "j", " ", "]"}], "]"}], "-", 
               RowBox[{"lotsofpoints", "[", 
                RowBox[{"[", "i", " ", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"lotsofpoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "+", 
                 RowBox[{"lotsofpoints", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], ")"}], "/", "2"}]}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "points", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"i", "+", "1"}], ",", 
              RowBox[{"Length", "[", "lotsofpoints", "]"}]}], "}"}]}], "]"}], 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"selectedconnections", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"connections", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "3", "]"}], "]"}], " ", "]"}], "<=", 
            "neighbourthreshold"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"selectedconnections2", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"selectedconnections", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"WithinRange", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"selectedconnections2", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "4"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PointBetweenAtoms3D", "[", 
    RowBox[{"points_", ",", "latticevecs_", ",", "neighbourthreshold_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "lotsofpoints", ",", "connections", ",", "selectedconnections", ",", 
       "selectedconnections2", ",", "WithinRange"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"WithinRange", "[", "point_", "]"}], ":=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ".", "point"}], "<", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "2"]}], "&&", 
          RowBox[{
           RowBox[{
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ".", "point"}], "<", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "2"]}], "&&", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ".", "point"}], "<", 
           SuperscriptBox[
            RowBox[{"Norm", "[", 
             RowBox[{"latticevecs", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "2"]}], "&&", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ".", "point"}], ">=", "0"}], "&&",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ".", "point"}], ">=", "0"}], "&&",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ".", "point"}], ">=", "0"}]}], 
         "\[IndentingNewLine]", ",", "True", ",", "False"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"lotsofpoints", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"points", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"latticevecs", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "&"}], "/@", "points"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"connections", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j", ",", 
             RowBox[{
              RowBox[{"lotsofpoints", "[", 
               RowBox[{"[", "j", " ", "]"}], "]"}], "-", 
              RowBox[{"lotsofpoints", "[", 
               RowBox[{"[", "i", " ", "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"lotsofpoints", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "+", 
                RowBox[{"lotsofpoints", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ")"}], "/", "2"}]}], "}"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "points", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"i", "+", "1"}], ",", 
             RowBox[{"Length", "[", "lotsofpoints", "]"}]}], "}"}]}], "]"}], 
         ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"selectedconnections", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"connections", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Norm", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], " ", "]"}], "<=", 
           "neighbourthreshold"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"selectedconnections2", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"selectedconnections", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"WithinRange", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"selectedconnections2", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "4"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{{3.5461913799560547`*^9, 3.546191392038086*^9}, {
   3.546191579669922*^9, 3.5461915991396484`*^9}, {3.5461916783095703`*^9, 
   3.5461916854052734`*^9}, {3.5461917640029297`*^9, 
   3.5461918305654297`*^9}, {3.5461920440146484`*^9, 
   3.5461921582695312`*^9}, {3.5461923495966797`*^9, 3.546192505520508*^9}, {
   3.5461927900146484`*^9, 3.546192791376953*^9}, {3.54619445025*^9, 
   3.546194469901367*^9}, {3.5461945946328125`*^9, 3.5461946220527344`*^9}, {
   3.546194660493164*^9, 3.5461947188583984`*^9}, {3.546194763270508*^9, 
   3.5461947707753906`*^9}, {3.5461948957128906`*^9, 3.546194914392578*^9}, {
   3.546195002841797*^9, 3.5461950117626953`*^9}, {3.5461952228789062`*^9, 
   3.546195225432617*^9}, {3.546195258598633*^9, 3.5461952790615234`*^9}, {
   3.5461957942382812`*^9, 3.54619580125*^9}, {3.546199064801758*^9, 
   3.5461990726728516`*^9}, {3.5462004665253906`*^9, 3.5462005606796875`*^9}, 
   3.546201214897461*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AppendGNRInitialGuess", "[", 
     RowBox[{"gnrwidth_", ",", "wannier90file_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "betwpoints", ",", "initialguess1", ",", "initialguess2", ",", 
        "initialguess3", ",", "NumberToString", ",", "basis", ",", "wfile", 
        ",", "raw1", ",", "raw2", ",", "raw3"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"NumberToString", "[", "x_", "]"}], ":=", 
        RowBox[{"ToString", "[", 
         RowBox[{"NumberForm", "[", 
          RowBox[{"x", ",", "20"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"basis", "=", 
        RowBox[{"gnrbasis", "[", "gnrwidth", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"betwpoints", "=", 
        RowBox[{"PointBetweenAtoms2D", "[", 
         RowBox[{"basis", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"GrapheneLatticeConstant", 
               SqrtBox["3"]}], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "10000"}], "}"}]}], "}"}], ",", 
          "GrapheneLatticeConstant"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"raw1", "=", 
        RowBox[{"Rest", "[", 
         RowBox[{"Most", "[", "basis", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"raw2", "=", "betwpoints"}], ";", "\[IndentingNewLine]", 
       RowBox[{"raw3", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"First", "[", "basis", "]"}], ",", 
          RowBox[{"Last", "[", "basis", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"initialguess1", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<c=\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<,\>\"", ",", "0", ",", 
            "\"\<:pz\>\""}], "}"}], "&"}], "/@", "raw1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"initialguess2", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<c=\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<,\>\"", ",", "0", ",", 
            "\"\<:s\>\""}], "}"}], "&"}], "/@", "raw2"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"initialguess3", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<c=\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,\>\"", ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<,\>\"", ",", "0", ",", 
            "\"\<:pz,py\>\""}], "}"}], "&"}], "/@", "raw3"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wfile", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FileExistsQ", "[", "wannier90file", "]"}], ",", 
          RowBox[{"Import", "[", 
           RowBox[{"wannier90file", ",", "\"\<Lines\>\""}], "]"}], ",", 
          RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"wannier90file", ",", 
         RowBox[{"Join", "[", 
          RowBox[{"wfile", ",", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"\"\<\>\"", ",", "\[IndentingNewLine]", 
             RowBox[{"\"\<num_wann=\>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{
                RowBox[{"Length", "[", "initialguess1", "]"}], "+", 
                RowBox[{"Length", "[", "initialguess2", "]"}], "+", 
                RowBox[{"2", 
                 RowBox[{"Length", "[", "initialguess3", "]"}]}]}], "]"}]}], 
             ",", "\[IndentingNewLine]", "\"\<\>\"", ",", 
             "\[IndentingNewLine]", "\"\<begin projections\>\""}], 
            "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"StringJoin", "[", 
              RowBox[{"NumberToString", "/@", "#"}], "]"}], "&"}], "/@", 
            RowBox[{"Join", "[", 
             RowBox[{
             "initialguess1", ",", "initialguess2", ",", "initialguess3"}], 
             "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
           "{", "\[IndentingNewLine]", "\"\<end projections\>\"", 
            "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "\"\< \>\"", "}"}]}], "]"}], ",", "\"\<Lines\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Join", "[", 
        RowBox[{"raw1", ",", "raw2", ",", "raw3"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AppendGNRhydrogenInitialGuess", "[", 
    RowBox[{"gnrwidth_", ",", "wannier90file_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "betwpoints", ",", "initialguess1", ",", "initialguess2", ",", 
       "initialguess3", ",", "NumberToString", ",", "basis", ",", "wfile", 
       ",", "raw1", ",", "raw2", ",", "raw3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"NumberToString", "[", "x_", "]"}], ":=", 
       RowBox[{"ToString", "[", 
        RowBox[{"NumberForm", "[", 
         RowBox[{"x", ",", "20"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"basis", "=", 
       RowBox[{"gnrbasiswithh", "[", "gnrwidth", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"betwpoints", "=", 
       RowBox[{"PointBetweenAtoms2D", "[", 
        RowBox[{
         RowBox[{"Drop", "[", 
          RowBox[{"basis", ",", 
           RowBox[{"-", "2"}]}], "]"}], 
         RowBox[{"(*", 
          RowBox[{"only", " ", "c", " ", "atoms"}], "*)"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"GrapheneLatticeConstant", 
              SqrtBox["3"]}], ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "10000"}], "}"}]}], "}"}], ",", 
         "GrapheneLatticeConstant"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"raw1", "=", 
       RowBox[{"Drop", "[", 
        RowBox[{"basis", ",", 
         RowBox[{"-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"raw2", "=", "betwpoints"}], ";", "\[IndentingNewLine]", 
      RowBox[{"raw3", "=", 
       RowBox[{"Take", "[", 
        RowBox[{"basis", ",", 
         RowBox[{"-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"initialguess1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<c=\>\"", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,\>\"", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<,\>\"", ",", "0", ",", 
           "\"\<:pz\>\""}], "}"}], "&"}], "/@", "raw1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"initialguess2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<c=\>\"", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,\>\"", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<,\>\"", ",", "0", ",", 
           "\"\<:s\>\""}], "}"}], "&"}], "/@", "raw2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"initialguess3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<c=\>\"", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<,\>\"", ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<,\>\"", ",", "0", ",", 
           "\"\<:s\>\""}], "}"}], "&"}], "/@", "raw3"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wfile", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FileExistsQ", "[", "wannier90file", "]"}], ",", 
         RowBox[{"Import", "[", 
          RowBox[{"wannier90file", ",", "\"\<Lines\>\""}], "]"}], ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"wannier90file", ",", 
        RowBox[{"Join", "[", 
         RowBox[{"wfile", ",", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"\"\<\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{"\"\<num_wann=\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{
               RowBox[{"Length", "[", "initialguess1", "]"}], "+", 
               RowBox[{"Length", "[", "initialguess2", "]"}], "+", 
               RowBox[{"Length", "[", "initialguess3", "]"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", "\"\<\>\"", ",", "\[IndentingNewLine]", 
            "\"\<begin projections\>\""}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"StringJoin", "[", 
             RowBox[{"NumberToString", "/@", "#"}], "]"}], "&"}], "/@", 
           RowBox[{"Join", "[", 
            RowBox[{
            "initialguess1", ",", "initialguess2", ",", "initialguess3"}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
          "{", "\[IndentingNewLine]", "\"\<end projections\>\"", 
           "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\"\< \>\"", "}"}]}], "]"}], ",", "\"\<Lines\>\""}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", 
       RowBox[{"raw1", ",", "raw2", ",", "raw3"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5477489487763906`*^9, 3.5477489778506093`*^9}, {
   3.5484200269247227`*^9, 3.548420030395625*^9}, 3.54842007164718*^9, {
   3.5484201030326643`*^9, 3.548420215216671*^9}, {3.548420346748386*^9, 
   3.548420350087237*^9}, {3.5484203869732027`*^9, 3.548420489237131*^9}, {
   3.5541013631829233`*^9, 3.5541013765887814`*^9}, {3.554114615963807*^9, 
   3.554114627058042*^9}, {3.5541150256356783`*^9, 3.554115029675623*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateGNRPOSCAR", "[", 
     RowBox[{
     "gnrwidth_", ",", "yspacing_", ",", "zspacing_", ",", "POSCARfile_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"gnrrealwidth", ",", "basis", ",", "filecontent"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"basis", "=", 
        RowBox[{"gnrbasis", "[", "gnrwidth", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"gnrrealwidth", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Max", "[", "#", "]"}], "-", 
           RowBox[{"Min", "[", "#", "]"}]}], "&"}], "[", 
         RowBox[{"basis", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"filecontent", "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<GNR Zigzag \>\"", "<>", 
              RowBox[{"ToString", "[", "gnrwidth", "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", "1", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"GrapheneLatticeConstant", 
               SqrtBox["3"]}], ",", "0.0", ",", "0.0"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"0.0", ",", 
              RowBox[{"gnrrealwidth", "+", "yspacing"}], ",", "0.0"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{
             "the", " ", "lattice", " ", "vectors", " ", "should", " ", "not",
               " ", "have", " ", "the", " ", "same", " ", "length"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"0.0", ",", "0.0", ",", "zspacing"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", "\"\<C\>\"", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"basis", "//", "Length"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", "\"\<Cartesian\>\"", "}"}]}], "\[IndentingNewLine]", 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"AddZeroInThirdDimension", "[", "basis", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\"\< \>\"", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"POSCARfile", ",", "filecontent", ",", "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\< \>\""}], ",", 
         RowBox[{"\"\<TextDelimiters\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateGNRhydrogenPOSCAR", "[", 
    RowBox[{
    "gnrwidth_", ",", "yspacing_", ",", "zspacing_", ",", "POSCARfile_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "gnrrealwidth", ",", "basis", ",", "filecontent", ",", 
       "relaxationparameters"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"basis", "=", 
       RowBox[{"gnrbasiswithh", "[", "gnrwidth", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"relaxationparameters", "=", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<T\>\"", ",", "\"\<T\>\"", ",", "\"\<F\>\""}], "}"}], 
           ",", 
           RowBox[{"(*", 
            RowBox[{"Two", " ", "bottom", " ", "carbon"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<T\>\"", ",", "\"\<T\>\"", ",", "\"\<F\>\""}], 
            "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<F\>\"", ",", "\"\<F\>\"", ",", "\"\<F\>\""}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{
              RowBox[{"Length", "[", "basis", "]"}], "-", "6"}]}], "}"}]}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<T\>\"", ",", "\"\<T\>\"", ",", "\"\<F\>\""}], "}"}], 
           ",", 
           RowBox[{"(*", 
            RowBox[{"Two", " ", "top", " ", "carbon"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<T\>\"", ",", "\"\<T\>\"", ",", "\"\<F\>\""}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<T\>\"", ",", "\"\<T\>\"", ",", "\"\<F\>\""}], "}"}], 
           ",", 
           RowBox[{"(*", "Hydrogen", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<T\>\"", ",", "\"\<T\>\"", ",", "\"\<F\>\""}], 
            "}"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gnrrealwidth", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", "#", "]"}], "-", 
          RowBox[{"Min", "[", "#", "]"}]}], "&"}], "[", 
        RowBox[{"basis", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "]"}]}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"filecontent", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<GNR Zigzag Hydrogenated \>\"", "<>", 
             RowBox[{"ToString", "[", "gnrwidth", "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "1", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"GrapheneLatticeConstant", 
              SqrtBox["3"]}], ",", "0.0", ",", "0.0"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"0.0", ",", 
             RowBox[{"gnrrealwidth", "+", "yspacing"}], ",", "0.0"}], "}"}], 
           ",", 
           RowBox[{"(*", 
            RowBox[{
            "the", " ", "lattice", " ", "vectors", " ", "should", " ", "not", 
             " ", "have", " ", "the", " ", "same", " ", "length", " ", 
             "because", " ", "vasp", " ", "assumes", " ", "a", " ", "wrong", 
             " ", "symmetry", " ", "then"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"0.0", ",", "0.0", ",", "zspacing"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<C\>\"", ",", "\"\<H\>\""}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "basis", "]"}], "-", "2"}], ",", "2"}], 
            "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", "\"\<Selective Dynamics\>\"", "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", "\"\<Cartesian\>\"", "}"}]}], "\[IndentingNewLine]", 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Transpose", "[", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"AddZeroInThirdDimension", "[", "basis", "]"}], "]"}], 
            ",", 
            RowBox[{"Transpose", "[", "relaxationparameters", "]"}]}], "]"}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\"\< \>\"", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"POSCARfile", ",", "filecontent", ",", "\"\<Table\>\"", ",", 
        RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\< \>\""}], ",", 
        RowBox[{"\"\<TextDelimiters\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.5477494815312734`*^9, 3.547749509800805*^9}, {
   3.5484186643375587`*^9, 3.548418695651904*^9}, {3.5484190663532143`*^9, 
   3.548419111666255*^9}, {3.548419754620792*^9, 3.548419766518614*^9}, {
   3.548422088995613*^9, 3.548422091186092*^9}, {3.5484857382285156`*^9, 
   3.5484857450966797`*^9}, {3.5484861865029297`*^9, 3.548486216883789*^9}, {
   3.5484862641748047`*^9, 3.548486295951172*^9}, 3.5484863789052734`*^9, {
   3.5515967182870693`*^9, 3.551596737086018*^9}, {3.551597271315111*^9, 
   3.551597271881198*^9}, {3.554115000671646*^9, 3.554115022347087*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["", "Subsubsection",
 InitializationGroup->True,
 CellChangeTimes->{{3.547035734347958*^9, 3.54703573457987*^9}, 
   3.54703577630091*^9}],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{
  RowBox[{"Protect", "@@", 
   RowBox[{"Names", "[", "\"\<dftinput`*\>\"", "]"}]}], ";"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationGroup->True,
 CellChangeTimes->{3.547035930813974*^9, 3.54703600372397*^9, 
  3.548419845736451*^9}]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{943, 867},
WindowMargins->{{Automatic, 350}, {Automatic, 47}},
FrontEndVersion->"8.0 for Linux x86 (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 738, 14, 69, "Input",
 InitializationCell->True],
Cell[1298, 36, 5939, 95, 905, "Input",
 InitializationCell->True],
Cell[7240, 133, 68, 1, 30, "Input"],
Cell[CellGroupData[{
Cell[7333, 138, 184, 3, 28, "Subsubsection",
 InitializationGroup->True],
Cell[7520, 143, 1075, 31, 148, "Input"],
Cell[8598, 176, 1234, 34, 132, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9869, 215, 129, 2, 28, "Subsubsection",
 InitializationGroup->True],
Cell[10001, 219, 2340, 68, 133, "Input",
 InitializationGroup->True],
Cell[12344, 289, 1067, 27, 69, "Input",
 InitializationGroup->True],
Cell[13414, 318, 1597, 41, 107, "Input",
 InitializationGroup->True],
Cell[15014, 361, 1385, 32, 145, "Input",
 InitializationGroup->True],
Cell[16402, 395, 1049, 28, 85, "Input",
 InitializationGroup->True],
Cell[17454, 425, 16138, 402, 1324, "Input",
 InitializationGroup->True],
Cell[33595, 829, 10483, 245, 1216, "Input"],
Cell[44081, 1076, 8703, 201, 1111, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[52821, 1282, 143, 3, 28, "Subsubsection",
 InitializationGroup->True],
Cell[52967, 1287, 319, 8, 69, "Input",
 InitializationGroup->True]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
